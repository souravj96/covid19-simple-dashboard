<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">

    <title>Hello, world!</title>
</head>

<body>
    <div class="row">
        <div class="w-100">
            <div id="myCarousel" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                    <li data-target="#myCarousel" data-slide-to="1"></li>
                    <li data-target="#myCarousel" data-slide-to="2"></li>
                    <li data-target="#myCarousel" data-slide-to="3"></li>
                    <li data-target="#myCarousel" data-slide-to="4"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="card m-2 shadow-sm bg-primary vh-100">
                            <div class="card-body">
                                <h1 class="text-center text-light" style="font-size: 96px;" id="current-time"></h1>
                                <h1 class="text-center text-light" id="current-date"></h1>
                                <h2 class="text-center text-light" id="current-day"></h2>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="card m-2 shadow-sm bg-success vh-100"
                            style="background-image: url('https://lh3.googleusercontent.com/proxy/MzUDR1XrPqIeLzKpEvnJmcrp0pz5VCdiRoghsTfsHkeU5Lr6eSZIqzsoBLqUs2IS0PLVXO1TBaZrVV--sSUoma0feVAitwBd9op2pzqZaNgiGtFdXOcE3pJ8Kv7d');">
                            <div class="card-body">
                                <p class="text-center text-light">TOTAL CONFIRMED</p>
                                <h1 class="text-center text-light" style="font-size: 72px;" id="world-total"></h1>
                                <p class="text-center text-danger">TOTAL DEATH</p>
                                <h1 class="text-center text-light" id="world-dead"></h1>
                                <h2 class="text-center text-light">WORLD</h2>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="card m-2 shadow-sm bg-warning vh-100"
                            style="background-image: url('https://i.ya-webdesign.com/images/india-map-outline-png-4.gif'); background-repeat: no-repeat; background-position: center center; background-size: 60% auto;">
                            <div class="card-body">
                                <div class="row w-100">
                                    <div class="col-xs-12 w-100">
                                        <p class="text-center text-light">TOTAL CONFIRMED</p>
                                        <h1 class="text-center text-light" style="font-size: 72px;" id="in-total"></h1>
                                    </div>
                                </div>
                                <div class="row w-100">
                                    <div class="w-50">
                                        <p class="text-center text-light">REPORTED TODAY</p>
                                        <h1 class="text-center text-light" id="in-today"></h1>
                                    </div>
                                    <div class="w-50">
                                        <p class="text-center text-danger">TOTAL DEATH</p>
                                        <h1 class="text-center text-light" id="in-dead"></h1>
                                    </div>
                                </div>
                                <h2 class="text-center text-light">INDIA</h2>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="card m-2 shadow-sm bg-danger vh-100"
                            style="background-image: url('https://pngimage.net/wp-content/uploads/2018/06/west-bengal-map-png-4.png'); background-repeat: no-repeat; background-position: center center; background-size: 100% auto;">
                            <div class="card-body">
                                <p class="text-center text-light">TOTAL CONFIRMED</p>
                                <h1 class="text-center text-light" style="font-size: 72px;" id="wb-total"></h1>
                                <div class="row w-100">
                                    <div class="w-50">
                                        <p class="text-center text-light">REPORTED TODAY</p>
                                        <h1 class="text-center text-light" id="wb-today"></h1>
                                    </div>
                                    <div class="w-50">
                                        <p class="text-center text-warning">TOTAL DEATH</p>
                                        <h1 class="text-center text-light" id="wb-dead"></h1>
                                    </div>
                                </div>
                                <h2 class="text-center text-light">WEST BENGAL</h2>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div id="time-series" style="height: 100vh;" class="m-4"></div>
                    </div>
                </div>
                <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- <div class="col-md-6">
            <div class="card m-2 shadow-sm bg-success">
                <div class="card-body">
                    <h1 class="text-center text-light" style="font-size: 72px;" id="world-total"></h1>
                    <p class="text-center text-danger" id="world-dead"></p>
                </div>
            </div>
        </div> -->
        <!-- <div class="col-md-6">
            <div class="card m-2 shadow-sm bg-warning">
                <div class="card-body">
                    <h1 class="text-center text-primary" style="font-size: 72px;" id="in-total"></h1>
                    <h4 class="text-center" id="in-today"></h4>
                    <p class="text-center text-danger" id="in-dead"></p>
                </div>
            </div>
        </div> -->
        <!-- <div class="col-md-6">
            <div class="card m-2 shadow-sm bg-primary">
                <div class="card-body">
                    <h1 class="text-center text-light" style="font-size: 72px;" id="current-time"></h1>
                    <h4 class="text-center text-light" id="current-date"></h4>
                    <p class="text-center text-light" id="current-day"></p>
                </div>
            </div>
        </div> -->
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script>
        function callCovid() {
            console.log('COVID API')
            $.ajax({
                url: "https://coronavirus-19-api.herokuapp.com/all",
                type: 'GET',
                dataType: 'json',
                success: function (res) {
                    $("#world-total").html(res.cases)
                    $("#world-dead").html(res.deaths)
                }
            });
            // $.ajax({
            //     url: "https://coronavirus-19-api.herokuapp.com/countries/india",
            //     type: 'GET',
            //     dataType: 'json',
            //     success: function (res) {
            //         $("#in-total").html(res.cases)
            //         $("#in-today").html(res.todayCases)
            //         $("#in-dead").html(res.deaths)
            //     }
            // });
            $.ajax({
                url: "https://api.rootnet.in/covid19-in/unofficial/covid19india.org",
                type: 'GET',
                dataType: 'json',
                success: function (res) {
                    $("#in-total").html(res.data.summary.total)
                    var inDead = res.data.rawPatientData.filter(patient => patient.status === "Deceased")
                    $("#in-dead").html(inDead.length)
                    var inToday = res.data.rawPatientData.filter(patient => patient.reportedOn === moment().format("DD/MM/YYYY"))
                    $("#in-today").html(inToday.length)
                    var wbData = res.data.rawPatientData.filter(patient => patient.state === "West Bengal")
                    $("#wb-total").html(wbData.length)
                    var wbToday = wbData.filter(patient => patient.reportedOn === moment().format("DD/MM/YYYY"))
                    $("#wb-today").html(wbToday.length)
                    var wbDead = wbData.filter(patient => patient.status === "Deceased")
                    $("#wb-dead").html(wbDead.length)
                }
            })
        }
        function callTime() {
            console.log('TIME API')
            $.ajax({
                url: "http://worldclockapi.com/api/json/utc/now",
                type: 'GET',
                dataType: 'json',
                success: function (res) {
                    $("#current-time").html(moment(res.currentDateTime).format("h:mm a"))
                    $("#current-date").html(moment(res.currentDateTime).format("MMM Do YYYY"))
                    $("#current-day").html(moment(res.currentDateTime).format("dddd"))
                }
            });
        }
        function timeSeriseChart() {
            console.log("GRAPH API")
            $.ajax({
                url: "https://api.covid19india.org/data.json",
                type: 'GET',
                dataType: 'json',
                success: function (res) {
                    var data = [], tempObj = {}, tempData = {}
                    for (let i = 0; i < res.cases_time_series.length - 1; i++) {
                        tempData = res.cases_time_series[i]
                        tempObj = {
                            index: i,
                            dailyconfirmed: tempData.dailyconfirmed,
                            dailyrecovered: tempData.dailyrecovered,
                            dailydeceased: tempData.dailydeceased,
                        }
                        data.push(tempObj)
                    }
                    var config = {
                        data: data,
                        xkey: 'index',
                        ykeys: ['dailyconfirmed', 'dailyrecovered', 'dailydeceased'],
                        labels: ['dailyconfirmed', 'dailyrecovered', 'dailydeceased'],
                        fillOpacity: 0.6,
                        hideHover: 'auto',
                        behaveLikeLine: true,
                        resize: true,
                        lineColors: ['gray', 'green', 'red']
                    };
                    config.element = 'time-series';
                    Morris.Line(config);
                }
            });
        }
        let interval = 0, curentSlid = 1
        function loop() {
            setTimeout(function () {
                if (interval == 4) {
                    interval = 0
                    callCovid()
                }
                else {
                    interval = interval + 1
                }
                callTime()
                loop()
            }, 1000 * 60);
        }
        $(document).ready(function () {
            callCovid()
            callTime()
            timeSeriseChart()
            loop()
        });
        $('#myCarousel').on('slid.bs.carousel', function (e) {
            if ($("#time-series").hasClass('loaded')) {
                return true;
            }
            else {
                if (interval == 0 && curentSlid === 4) {
                    timeSeriseChart()
                }
            }
            if (curentSlid === 4) {
                curentSlid = 0
            }
            else {
                curentSlid = curentSlid + 1
            }
        })
    </script>
</body>

</html>